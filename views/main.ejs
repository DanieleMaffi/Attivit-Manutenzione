<!doctype html>
<html lang="en" data-bs-theme="light">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../style.css">
    <!-- Bootstrap CSS -->
    <title>Form</title>
</head>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="border-bottom: 1mm ridge rgba(116, 116, 116, 0.6);">
    <div class="container-fluid">
        <img src="/logo.png" style="width: 8%; margin-top: 7px;" class="avatar" alt="user profile picture">
        <a style="letter-spacing: 2px; margin-left: 25px; font-weight: 600;" class="navbar-brand col" href="#">Attivit√†
            Manutenzione</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            </ul>
        </div>
        <p style="height: fit-content; margin: 0; margin-right: 20px; color: #e5e5e5;" class="navbar-text">
            <%= user %>
        </p>
        <a class="idLink nav-link" style="color: #e5e5e5;" href="/auth/changePassword">Cambia password</a>
        <a class="idLink nav-link" style="margin-left: 4px; margin-right: 10px; color: #e5e5e5;" href="/auth/logout">Log out</a>
    </div>
</nav>

<body>
    <div class="container my-5" style="display: flex; height: calc(100vh - 180px); align-items: center;">
        <div class="card mx-auto" style="width: 40rem;">
            <div class="card-body">
                <div class="container-fluid">
                    <h3>Ordini pendenti</h3>
                    <a href="#" id="reloadBtn" class="idLink">Aggiorna</a>
                </div>
                <table class="table table-hover">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Descrizione</th>
                            <th scope="col">Stato</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(let i=0; i < odl.length; i++) { %>
                            <tr>
                                <th scope="row">
                                    <a class="link-body-emphasis idLink" href="/odlInfo/<%=odl[i].ID%>">
                                        <%=odl[i].ID%>
                                    </a>
                                </th>
                                <td>
                                    <%=odl[i].DescrizioneLavori%>
                                </td>
                                <td>
                                    <% if (odl[i].Stato==0) { %>
                                        Sconosciuto
                                        <% } else if (odl[i].Stato==10) { %>
                                            Ricevuto
                                            <% } else if (odl[i].Stato==20) { %>
                                                In attesa di delibera
                                                <% } else if (odl[i].Stato==30) { %>
                                                    Approvato
                                                    <% } else if (odl[i].Stato==40) { %>
                                                        In attesa di materiali
                                                        <% } else if (odl[i].Stato==50) { %>
                                                            Programmato
                                                            <% } else if (odl[i].Stato==60) { %>
                                                                In corso...
                                                                <% } else if (odl[i].Stato==90) { %>
                                                                    Concluso
                                                                    <% } else { %>
                                                                        Annullato
                                                                        <% } %>
                                </td>
                            </tr>
                            <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <p class="newOrder center-con">Nuovo ordine</p>
    <div class="center-con">
        <div class="round">
            <span class="drawSpace"></span>
            <span class="drawSpace"></span>
            <span class="drawSpace"></span>
            <span class="drawSpace"></span>
        </div>
    </div>
    <div class="container my-5" style="display: flex; height: calc(100vh - 180px); align-items: center;">
        <div class="card mx-auto" style="width: 40rem;">
            <div class="card-body">
                <form action="/upload/sendForm" method="POST" id="usrform">
                    <h4 class="mb-4">Inserire i dati</h4>
                    <div class="mb-4">
                        <label for="stabilimento" class="form-label">Stabilimento</label>
                        <select class="form-control" name="stabilimento" id="stabilimento">
                            <option value="none" selected disabled hidden>
                                Seleziona uno stabilimento
                            </option>
                            <% for (var i=0; i < stabilimenti.length; i++) { %>
                                <option value="<%=stabilimenti[i].ID%>">
                                    <%=stabilimenti[i].Nome%>
                                </option>
                                <% } %>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="reparto" class="form-label">Reparto</label>
                        <select class="form-control" name="reparto" id="reparto">
                            <option value="none" selected disabled hidden>
                                Seleziona un reparto
                            </option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="impianto" class="form-label">Impianto</label>
                        <select class="form-control" name="impianto" id="impianto">
                            <option value="none" selected disabled hidden>
                                Seleziona un impianto
                            </option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="zona" class="form-label">Zona</label>
                        <select class="form-control" name="zona" id="zona">
                            <option value="none" selected disabled hidden>
                                Seleziona una zona
                            </option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="posizione" class="form-label">Posizione</label>
                        <select class="form-control" name="posizione" id="posizione">
                            <option value="none" selected disabled hidden>
                                Seleziona una posizione
                            </option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="descrizione" class="form-label">Richiesta intervento</label>
                        <textarea class="form-control" name="descrizione" cols="40" rows="5"></textarea>
                        <!--<input class="form-control" type="text" name="descrizione" id="descrizione">-->
                    </div>
                    <button type="submit" class="btn btn-primary mt-1 mb-2">Invia</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        //When select stabilimento is changed this function is called
        document.getElementById('stabilimento').addEventListener('change', () => {
            let stabilimento = document.getElementById('stabilimento')
            let reparto = document.getElementById('reparto')
            reparto.options.length = 0 //deletes innerHTML of select

            let option = document.createElement("option");
            option.value = "none"
            option.text = "Seleziona un reparto"
            option.disabled = true
            option.selected = true
            option.hidden = true
            reparto.appendChild(option)

                <% for (let i = 0; i < reparti.length; i++) { %>
                if (<%= reparti[i].ID_Stabilimento %> == stabilimento.value) {
            let option = document.createElement("option");
            option.value = <%= reparti[i].ID %>
                option.text = "<%= reparti[i].Nome %>"
            reparto.appendChild(option)
        }
            <% } %>
        })

        document.getElementById('reparto').addEventListener('change', () => {
            let reparto = document.getElementById('reparto')
            let impianto = document.getElementById('impianto')
            impianto.options.length = 0 //deletes innerHTML of select

            let option = document.createElement("option");
            option.value = "none"
            option.text = "Seleziona un impianto"
            option.disabled = true
            option.selected = true
            option.hidden = true
            impianto.appendChild(option)

                <% for (let i = 0; i < impianti.length; i++) { %>
                if (<%= impianti[i].ID_Reparto %> == reparto.value) {
            let option = document.createElement("option");
            option.value = <%= impianti[i].ID %>
                option.text = "<%= impianti[i].Nome %>"
            impianto.appendChild(option)
        }
            <% } %>
        })

        document.getElementById('impianto').addEventListener('change', () => {
            let impianto = document.getElementById('impianto')
            let zona = document.getElementById('zona')
            zona.options.length = 0 //deletes innerHTML of select

            let option = document.createElement("option");
            option.value = "none"
            option.text = "Seleziona una zona"
            option.disabled = true
            option.selected = true
            option.hidden = true
            zona.appendChild(option)

                <% for (let i = 0; i < zone.length; i++) { %>
                if (<%= zone[i].ID_Impianto %> == impianto.value) {
            let option = document.createElement("option");
            option.value = <%= zone[i].ID %>
                option.text = "<%= zone[i].Nome %>"
            zona.appendChild(option)
        }
            <% } %>
        })

        document.getElementById('zona').addEventListener('change', () => {
            let zona = document.getElementById('zona')
            let posizione = document.getElementById('posizione')
            posizione.options.length = 0 //deletes innerHTML of select

            let option = document.createElement("option");
            option.value = "none"
            option.text = "Seleziona una posizione"
            option.disabled = true
            option.selected = true
            option.hidden = true
            posizione.appendChild(option)

                <% for (let i = 0; i < posizioni.length; i++) { %>
                if (<%= posizioni[i].ID_Zona %> == zona.value) {
            let option = document.createElement("option");
            option.value = <%= posizioni[i].ID %>
                option.text = "<%= posizioni[i].Nome %>"
            posizione.appendChild(option)
        }
            <% } %>
        })

        //The function scrolls down the page
        let scrollDown = () => {
            window.scrollTo(0, document.body.scrollHeight);
        }

        let elements = document.getElementsByClassName("center-con")

        //When an element with this class is clicked, the function is called
        for (var i = 0; i < elements.length; i++) {
            elements[i].addEventListener('click', scrollDown, false);
        }

        //Reloads the page when btn is pressed
        document.getElementById('reloadBtn').addEventListener('click', () => {
            location.reload();
        })

        document.body.style.overflow = 'hidden';    //hides scrollbar
    </script>
</body>
<!--
                 *       +
           '                  |
       ()    .-.,="``"=.    - o -
             '=/_       \     |
          *   |  '=._    |
               \     `=./`,        '
            .   '=.__.=' `='      *
   +                         +
        O      *        '       .
-->

</html>